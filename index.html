<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cs-ddl</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- 导航栏 -->
    <nav>
        <ul id="navbar">
            <li><a href="#" id="nav-competition" class="active" onclick="showSection('competition-section')">竞赛信息</a></li>
            <li><a href="#" id="nav-courses" onclick="showSection('courses-section')">选课红黑榜</a></li>
            <li><a href="#" id="nav-testimonials" onclick="showSection('testimonials-section')">学长说</a></li>
        </ul>
    </nav>

    <!-- 竞赛信息部分 -->
    <div id="competition-section" class="section">
        <div id="competition-list" class="list-container"></div>
    </div>

    <!-- 选课红黑榜部分 -->
    <div id="courses-section" class="section" style="display: none;">
        <div id="course-list" class="list-container"></div>
    </div>

    <!-- 学长说部分 -->
    <div id="testimonials-section" class="section" style="display: none;">
        <div id="testimonial-list" class="list-container"></div>
    </div>

    <script>
        // 导航栏点击切换显示的内容
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => section.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';
            document.querySelectorAll('#navbar a').forEach(nav => nav.classList.remove('active'));
            document.querySelector(`#nav-${sectionId.split('-')[0]}`).classList.add('active');
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            return isNaN(date) ? '无效日期' : date.toLocaleString();
        }

        // 显示倒计时
        function getCountdown(deadline) {
            const now = new Date();
            const timeDiff = new Date(deadline) - now;
            if (timeDiff <= 0) {
                return '<span style="color: red;">（已过期）</span>'; // 已过期
            }
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            return `${days}天 ${hours}小时 ${minutes}分钟 ${seconds}秒`;
        }

        // 加载竞赛信息并按报名截止日期排序
        fetch('data/competitions.json')
            .then(response => response.json())
            .then(data => {
                const now = new Date();
                // 按报名截止日期排序，优先显示最近的
                data.sort((a, b) => new Date(a.signup_deadline) - new Date(b.signup_deadline));

                const competitionList = document.getElementById('competition-list');
                data.forEach(competition => {
                    const competitionCard = document.createElement('div');
                    competitionCard.classList.add('card');

                    // 报名倒计时或已过期提示
                    const signupDeadline = new Date(competition.signup_deadline);
                    let countdownText = getCountdown(signupDeadline);

                    competitionCard.innerHTML = `
                        <h3>${competition.name}</h3>
                        <p>类别: ${competition.category || '未定义'}</p>
                        <p>报名截止日期: ${formatDate(competition.signup_deadline)} ${countdownText}</p>
                        <p>提交作品截止日期: ${formatDate(competition.submission_deadline)}</p>
                        <p>级别: ${competition.level || '未定义'}</p>
                        <p>赛事文件：<a href="${competition.params_file}" target="_blank">下载参赛文件</a></p>
                        <p>推荐指数: ${competition.recommendation || '未定义'}/5</p>
                        <p>赛事官网：<a href="${competition.website}" target="_blank">查看详情</a></p>
                        <p>备注：${competition.remarks || '无'}</p>
                    `;
                    competitionList.appendChild(competitionCard);
                });

                // 实时更新倒计时
                setInterval(() => {
                    competitionList.innerHTML = '';
                    data.forEach(competition => {
                        const competitionCard = document.createElement('div');
                        competitionCard.classList.add('card');

                        // 报名倒计时或已过期提示
                        const signupDeadline = new Date(competition.signup_deadline);
                        let countdownText = getCountdown(signupDeadline);

                        competitionCard.innerHTML = `
                            <h3>${competition.name}</h3>
                            <p>类别: ${competition.category || '未定义'}</p>
                            <p>报名截止日期: ${formatDate(competition.signup_deadline)} ${countdownText}</p>
                            <p>提交作品截止日期: ${formatDate(competition.submission_deadline)}</p>
                            <p>级别: ${competition.level || '未定义'}</p>
                            <p>赛事文件：<a href="${competition.params_file}" target="_blank">下载参赛文件</a></p>
                            <p>推荐指数: ${competition.recommendation || '未定义'}/5</p>
                            <p>赛事官网：<a href="${competition.website}" target="_blank">查看详情</a></p>
                            <p>备注：${competition.remarks || '无'}</p>
                        `;
                        competitionList.appendChild(competitionCard);
                    });
                }, 1000); // 每秒更新一次倒计时
            });
    </script>

</body>
</html>
